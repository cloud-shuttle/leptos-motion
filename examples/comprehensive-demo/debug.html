<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leptos Motion - Debug</title>
    <style>
        body {
            font-family: system-ui, sans-serif;
            padding: 2rem;
            background: #1a1a1a;
            color: white;
        }
        .debug-panel {
            background: #2a2a2a;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border: 1px solid #444;
        }
        .error {
            color: #ff6b6b;
        }
        .success {
            color: #4ecdc4;
        }
        .warning {
            color: #feca57;
        }
        .log {
            background: #333;
            padding: 0.5rem;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>üîç Leptos Motion Debug Panel</h1>

    <div class="debug-panel">
        <h2>WASM Loading Status</h2>
        <div id="wasm-status">Loading...</div>
    </div>

    <div class="debug-panel">
        <h2>Console Logs</h2>
        <div id="console-logs" class="log"></div>
    </div>

    <div class="debug-panel">
        <h2>Error Logs</h2>
        <div id="error-logs" class="log"></div>
    </div>

    <div class="debug-panel">
        <h2>Page Content</h2>
        <div id="page-content"></div>
    </div>

    <script>
        // Capture console logs
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;

        const consoleLogs = document.getElementById('console-logs');
        const errorLogs = document.getElementById('error-logs');

        function addLog(type, message) {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${type}: ${message}\n`;

            if (type === 'ERROR') {
                errorLogs.textContent += logEntry;
            } else {
                consoleLogs.textContent += logEntry;
            }
        }

        console.log = function(...args) {
            originalLog.apply(console, args);
            addLog('LOG', args.join(' '));
        };

        console.error = function(...args) {
            originalError.apply(console, args);
            addLog('ERROR', args.join(' '));
        };

        console.warn = function(...args) {
            originalWarn.apply(console, args);
            addLog('WARN', args.join(' '));
        };

        // Monitor WASM loading
        const wasmStatus = document.getElementById('wasm-status');

        async function loadWasm() {
            try {
                wasmStatus.innerHTML = '<span class="warning">Loading WASM...</span>';
                console.log('Starting WASM import...');

                const init = await import('./pkg/comprehensive_demo.js');
                console.log('WASM module imported successfully');

                wasmStatus.innerHTML = '<span class="success">WASM module imported</span>';
                console.log('Initializing WASM...');

                await init.default();
                console.log('WASM initialized successfully');

                wasmStatus.innerHTML = '<span class="success">‚úÖ WASM loaded and initialized</span>';

                // Check if Leptos app mounted
                setTimeout(() => {
                    const leptosContent = document.querySelector('[data-leptos-hydrate]') ||
                                        document.querySelector('.leptos-app') ||
                                        document.body.innerHTML.includes('FeatureShowcaseDemo');

                    if (leptosContent) {
                        console.log('‚úÖ Leptos app appears to be mounted');
                        wasmStatus.innerHTML += '<br><span class="success">‚úÖ Leptos app mounted</span>';
                    } else {
                        console.warn('‚ö†Ô∏è Leptos app may not have mounted properly');
                        wasmStatus.innerHTML += '<br><span class="warning">‚ö†Ô∏è Leptos app not detected</span>';
                    }
                }, 1000);

            } catch (error) {
                console.error('WASM loading failed:', error);
                wasmStatus.innerHTML = `<span class="error">‚ùå WASM loading failed: ${error.message}</span>`;
            }
        }

        // Monitor page content
        function updatePageContent() {
            const pageContent = document.getElementById('page-content');
            const bodyHTML = document.body.innerHTML;

            // Check for key elements
            const hasHeading = bodyHTML.includes('üöÄ Leptos Motion');
            const hasWasmScript = bodyHTML.includes('comprehensive_demo.js');
            const hasLeptosContent = bodyHTML.includes('FeatureShowcaseDemo') ||
                                   bodyHTML.includes('Simple API') ||
                                   bodyHTML.includes('Independent Transforms');

            pageContent.innerHTML = `
                <div>Heading present: ${hasHeading ? '‚úÖ' : '‚ùå'}</div>
                <div>WASM script: ${hasWasmScript ? '‚úÖ' : '‚ùå'}</div>
                <div>Leptos content: ${hasLeptosContent ? '‚úÖ' : '‚ùå'}</div>
                <div>Body length: ${bodyHTML.length} characters</div>
            `;
        }

        // Start monitoring
        loadWasm();
        updatePageContent();

        // Update content every second
        setInterval(updatePageContent, 1000);

        // Global error handler
        window.addEventListener('error', (event) => {
            console.error('Global error:', event.error);
        });

        window.addEventListener('unhandledrejection', (event) => {
            console.error('Unhandled promise rejection:', event.reason);
        });
    </script>
</body>
</html>
